/*! For license information please see 806.1ed3ec26a80821b37f5c.js.LICENSE.txt */
"use strict";(self.webpackChunkkaraoke_forever=self.webpackChunkkaraoke_forever||[]).push([[806],{15806:(e,t,r)=>{r.r(t),r.d(t,{default:()=>we});var i=r(5556),n=r.n(i),s=r(96540),o=r(6527),u=r(5221),a=r(64467),c=r(44063),l=r(62244);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){(0,a.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var y=(0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)((0,a.A)({},l.PLAYER_CMD_NEXT,function(e,t){return t.payload,d(d({},e),{},{isPlayingNext:!0})}),l.PLAYER_CMD_OPTIONS,function(e,t){var r=t.payload;return d(d({},e),{},{cdgAlpha:"number"==typeof r.cdgAlpha?r.cdgAlpha:e.cdgAlpha,cdgSize:"number"==typeof r.cdgSize?r.cdgSize:e.cdgSize,mp4Alpha:"number"==typeof r.mp4Alpha?r.mp4Alpha:e.mp4Alpha})}),l.PLAYER_CMD_PAUSE,function(e,t){return t.payload,d(d({},e),{},{isPlaying:!1})}),l.PLAYER_CMD_PLAY,function(e,t){return t.payload,d(d({},e),{},{isPlaying:!0})}),l.PLAYER_CMD_VOLUME,function(e,t){var r=t.payload;return d(d({},e),{},{volume:r})}),l.PLAYER_CMD_RESTART,function(e,t){return t.payload,d(d({},e),{},{historyJSON:"[]",isAtQueueEnd:!1,isPlaying:!0,isPlayingNext:!0,position:0,queueId:-1})}),l.PLAYER_ERROR,function(e,t){var r=t.payload;return d(d({},e),{},{errorMessage:r.message,isErrored:!0,isFetching:!1,isPlaying:!1})}),l.PLAYER_LOAD,function(e,t){return t.payload,d(d({},e),{},{errorMessage:"",isErrored:!1,isFetching:!0})}),l.PLAYER_PLAY,function(e,t){return t.payload,d(d({},e),{},{isFetching:!1})}),l.PLAYER_UPDATE,function(e,t){var r=t.payload;return d(d({},e),r)}),h={cdgAlpha:.5,cdgSize:.8,errorMessage:"",historyJSON:"[]",isAtQueueEnd:!1,isErrored:!1,isFetching:!1,isPlaying:!1,isPlayingNext:!1,isWebGLSupported:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("webgl2")}catch(e){return!1}}(),mediaType:null,mp4Alpha:1,position:0,queueId:-1,rgTrackGain:null,rgTrackPeak:null,volume:1};function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0,r=y[t.type];return r?r(e,t):e}var g=r(82284),f=r(18182);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){(0,a.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var b=Object.keys(f.A),E=(0,a.A)((0,a.A)((0,a.A)({},l.PLAYER_LOAD,function(e,t){return t.payload,A(A({},e),q())}),l.PLAYER_CMD_OPTIONS,function(e,t){var r=t.payload.visualizer;if("object"!==(0,g.A)(r))return e;var i={};if(r.nextPreset||r.prevPreset){var n=b.indexOf(e.presetKey),s=n===b.length-1?0:n+1,o=0===n?b.length-1:n-1;i=P(r.nextPreset?s:r.prevPreset?o:n)}else r.randomPreset&&(i=q());return A(A(A({},e),i),{},{isEnabled:"boolean"==typeof r.isEnabled?r.isEnabled:e.isEnabled,sensitivity:"number"==typeof r.sensitivity?r.sensitivity:e.sensitivity})}),l.PLAYER_VISUALIZER_ERROR,function(e,t){return t.payload,A(A({},e),{},{isSupported:!1})}),L=A(A({isEnabled:!0,isSupported:!0},q()),{},{sensitivity:1});function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0,r=E[t.type];return r?r(e,t):e}function P(e){return{presetKey:b[e],presetName:"[".concat(e+1,"/").concat(b.length,"] ")+b[e]}}function q(){return P(Math.floor(Math.random()*(b.length-1)))}var S=r(23029),I=r(92901),O=r(56822),T=r(53954),w=r(85501),k=r(58168),C=r(80296),N=r(19699),D=r.n(N),G=r(74076);function x(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(x=function(){return!!e})()}var M=new G.A("media"),_=parseInt(getComputedStyle(document.body).getPropertyValue("--border-radius")),U=function(e){function t(){var e,r,i,n;(0,S.A)(this,t);for(var o=arguments.length,u=new Array(o),c=0;c<o;c++)u[c]=arguments[c];return r=this,i=t,n=[].concat(u),i=(0,T.A)(i),e=(0,O.A)(r,x()?Reflect.construct(i,n||[],(0,T.A)(r).constructor):i.apply(r,n)),(0,a.A)(e,"audio",s.createRef()),(0,a.A)(e,"canvas",s.createRef()),(0,a.A)(e,"frameId",null),(0,a.A)(e,"supportsFilters",CSS.supports("backdrop-filter","blur(10px) brightness(100%) saturate(100%)")||CSS.supports("-webkit-backdrop-filter","blur(10px) brightness(100%) saturate(100%)")),(0,a.A)(e,"state",{backgroundRGBA:[0,0,0,0],contentBounds:[0,0,0,0]}),(0,a.A)(e,"updateSources",function(){e.stopCDG(),M("GET","/".concat(e.props.mediaId,"?type=cdg")).then(function(e){return e.arrayBuffer()}).then(function(t){e.cdg.load(t),e.audio.current.src="".concat(document.baseURI,"api/media/").concat(e.props.mediaId,"?type=audio"),e.audio.current.load()}).catch(function(t){e.props.onError(t.message)})}),(0,a.A)(e,"updateIsPlaying",function(){e.props.isPlaying?e.audio.current.play().catch(function(t){return e.props.onError(t.message)}):(e.audio.current.pause(),e.stopCDG())}),(0,a.A)(e,"handleEnded",function(t){e.props.onEnd(),e.stopCDG()}),(0,a.A)(e,"handleError",function(t){var r=t.target.error,i=r.message,n=r.code;e.props.onError("".concat(i," (code ").concat(n,")"))}),(0,a.A)(e,"handlePlay",function(){e.props.onPlay(),e.startCDG()}),(0,a.A)(e,"handleTimeUpdate",function(){e.props.onStatus({position:e.audio.current.currentTime})}),(0,a.A)(e,"paintCDG",function(t){var r=e.canvas.current,i=r.clientWidth,n=r.clientHeight;e.canvasCtx.imageSmoothingEnabled=!1,e.canvasCtx.shadowBlur=Math.min(16,n*e.props.cdgSize*.0333),e.canvasCtx.shadowColor="rgba(0,0,0,1)",e.canvasCtx.clearRect(0,0,i,n),e.canvasCtx.drawImage(t,0,0,i,n)}),(0,a.A)(e,"startCDG",function(){e.frameId=requestAnimationFrame(e.startCDG);var t=e.cdg.render(e.audio.current.currentTime,{forceKey:!0});t.isChanged&&(t.backgroundRGBA.every(function(t,r){return t===e.state.backgroundRGBA[r]})||e.setState({backgroundRGBA:t.backgroundRGBA}),t.contentBounds.every(function(t,r){return t===e.state.contentBounds[r]})||e.setState({contentBounds:t.contentBounds}),createImageBitmap(t.imageData).then(function(t){e.lastBitmap=t,e.paintCDG(t)}))}),(0,a.A)(e,"stopCDG",function(){return cancelAnimationFrame(e.frameId)}),e}return(0,w.A)(t,e),(0,I.A)(t,[{key:"componentDidMount",value:function(){this.canvasCtx=this.canvas.current.getContext("2d"),this.cdg=new(D()),this.props.onAudioElement(this.audio.current),this.updateSources()}},{key:"componentDidUpdate",value:function(e){e.mediaKey===this.props.mediaKey?(e.isPlaying!==this.props.isPlaying&&this.updateIsPlaying(),e.width===this.props.width&&e.height===this.props.height&&e.cdgSize===this.props.cdgSize||this.lastBitmap&&this.paintCDG(this.lastBitmap)):this.updateSources()}},{key:"componentWillUnmount",value:function(){this.stopCDG()}},{key:"render",value:function(){var e=this.props,t=e.cdgAlpha,r=e.cdgSize,i=e.width,n=e.height,o=(0,C.A)(this.state.contentBounds,4),u=o[0],a=o[1],c=o[2],l=o[3],p=(0,C.A)(this.state.backgroundRGBA,4),d=p[0],y=p[1],h=p[2],m=(p[3],[]),g=(i-10)/300,f=(n-10)*r/216,v=Math.min(g,f),A=c-u&&l-a?5:0;return this.supportsFilters&&(m.push("blur(".concat(30*t*v,"px)")),m.push("brightness(".concat(100-100*Math.pow(t,3),"%)")),m.push("saturate(".concat(100-100*Math.pow(t,3),"%)"))),s.createElement("div",{className:"TPkYtEozIQtnpepk8MHq"},s.createElement("div",{className:"tn97LaCi4L2RekBwCyAM",style:{backdropFilter:this.supportsFilters&&1!==t?m.join(" "):"none",backgroundColor:this.supportsFilters&&1!==t?"transparent":"rgba(".concat(d,",").concat(y,",").concat(h,",").concat(t,")"),borderRadius:_*v,left:(u-A)*v,top:(a-A)*v,width:(c-u+2*A)*v,height:(l-a+2*A)*v}}),s.createElement("canvas",{ref:this.canvas,className:"FouT3gwlMtqtJx_j19T_",width:300*v,height:216*v}),s.createElement("br",null),s.createElement("audio",{preload:"auto",onCanPlayThrough:this.updateIsPlaying,onEnded:this.handleEnded,onError:this.handleError,onLoadStart:this.props.onLoad,onPlay:this.handlePlay,onTimeUpdate:this.handleTimeUpdate,ref:this.audio}))}}])}(s.Component);(0,a.A)(U,"propTypes",{cdgAlpha:n().number.isRequired,cdgSize:n().number.isRequired,isPlaying:n().bool.isRequired,mediaId:n().number.isRequired,mediaKey:n().number.isRequired,width:n().number.isRequired,height:n().number.isRequired,onAudioElement:n().func.isRequired,onEnd:n().func.isRequired,onError:n().func.isRequired,onLoad:n().func.isRequired,onPlay:n().func.isRequired,onStatus:n().func.isRequired});const j=U;function B(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(B=function(){return!!e})()}var z=function(e){function t(){var e,r,i,n;(0,S.A)(this,t);for(var o=arguments.length,u=new Array(o),c=0;c<o;c++)u[c]=arguments[c];return r=this,i=t,n=[].concat(u),i=(0,T.A)(i),e=(0,O.A)(r,B()?Reflect.construct(i,n||[],(0,T.A)(r).constructor):i.apply(r,n)),(0,a.A)(e,"video",s.createRef()),(0,a.A)(e,"updateSources",function(){e.video.current.src="".concat(document.baseURI,"api/media/").concat(e.props.mediaId,"?type=video"),e.video.current.load()}),(0,a.A)(e,"updateIsPlaying",function(){e.props.isPlaying?e.video.current.play().catch(function(t){return e.props.onError(t.message)}):e.video.current.pause()}),(0,a.A)(e,"handleError",function(t){var r=t.target.error,i=r.message,n=r.code;e.props.onError("".concat(i," (code ").concat(n,")"))}),(0,a.A)(e,"handlePlay",function(){return e.props.onPlay()}),(0,a.A)(e,"handleTimeUpdate",function(){e.props.onStatus({position:e.video.current.currentTime})}),e}return(0,w.A)(t,e),(0,I.A)(t,[{key:"componentDidMount",value:function(){this.props.onAudioElement(this.video.current),this.updateSources()}},{key:"componentDidUpdate",value:function(e){e.mediaKey!==this.props.mediaKey&&this.updateSources(),e.isPlaying!==this.props.isPlaying&&this.updateIsPlaying()}},{key:"render",value:function(){var e=this.props,t=e.width,r=e.height;return s.createElement("video",{className:"zCLVuxOKMU3YP7R5BUFg",preload:"auto",width:t,height:r,onCanPlayThrough:this.updateIsPlaying,onEnded:this.props.onEnd,onError:this.handleError,onLoadStart:this.props.onLoad,onPlay:this.handlePlay,onTimeUpdate:this.handleTimeUpdate,ref:this.video})}}])}(s.Component);(0,a.A)(z,"propTypes",{isPlaying:n().bool.isRequired,mediaId:n().number.isRequired,mediaKey:n().number.isRequired,width:n().number.isRequired,height:n().number.isRequired,onAudioElement:n().func.isRequired,onEnd:n().func.isRequired,onError:n().func.isRequired,onLoad:n().func.isRequired,onPlay:n().func.isRequired,onStatus:n().func.isRequired});const V=z,F="YSXpZaOblVLadevcgYb7",Y="x3E5ZeH5JKOXrjEwdTQi",Q="MalDtjUhySEiEGg7VJAt";function J(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(J=function(){return!!e})()}var W=function(e){function t(){var e,r,i,n;(0,S.A)(this,t);for(var o=arguments.length,u=new Array(o),c=0;c<o;c++)u[c]=arguments[c];return r=this,i=t,n=[].concat(u),i=(0,T.A)(i),e=(0,O.A)(r,J()?Reflect.construct(i,n||[],(0,T.A)(r).constructor):i.apply(r,n)),(0,a.A)(e,"state",{lyricsUpdateTimer:!1}),(0,a.A)(e,"video",s.createRef()),(0,a.A)(e,"upcomingLyrics",s.createRef()),(0,a.A)(e,"playedLyrics",s.createRef()),(0,a.A)(e,"progressBar",s.createRef()),(0,a.A)(e,"previousCurrentLine",null),(0,a.A)(e,"gapStart",-1),(0,a.A)(e,"gapEnd",-1),(0,a.A)(e,"updateSources",function(){e.stopLyricsTimer(),e.setState({currentTime:0}),e.video.current.src="".concat(document.baseURI,"api/youtube/").concat(e.props.youtubeVideoId),e.video.current.load(),e.previousCurrentLine=null,e.startLyricsTimer()}),(0,a.A)(e,"updateIsPlaying",function(){e.props.isPlaying?(e.video.current.play().catch(function(t){return e.props.onError(t.message)}),e.startLyricsTimer()):(e.video.current.pause(),e.stopLyricsTimer())}),(0,a.A)(e,"handleError",function(t){var r=t.target.error,i=r.message,n=r.code;e.props.onError("".concat(i," (code ").concat(n,")"))}),(0,a.A)(e,"handlePlay",function(){return e.props.onPlay()}),(0,a.A)(e,"handleTimeUpdate",function(){e.props.onStatus({position:e.video.current.currentTime})}),e}return(0,w.A)(t,e),(0,I.A)(t,[{key:"componentDidMount",value:function(){this.props.onAudioElement(this.video.current),this.updateSources()}},{key:"componentDidUpdate",value:function(e){e.youtubeVideoId!==this.props.youtubeVideoId&&this.updateSources(),e.isPlaying!==this.props.isPlaying&&this.updateIsPlaying()}},{key:"renderLyricsLines",value:function(){var e=this;return this.props.youtubeAlignedLyrics.map(function(t,r){return s.createElement("div",{key:e.props.youtubeVideoId+"_line_"+r,className:"rCyxQv05D3dTG2eROVUe"},e.renderLyricsWords(r,t))})}},{key:"renderLyricsWords",value:function(e,t){var r=this;return t.map(function(t,i){return s.createElement("span",{key:r.props.youtubeVideoId+"_line_"+e+"_word_"+i,className:"lBR9U4QmpTQcSHcaMrXJ"},s.createElement("span",{className:"CabsOoc6mXWU8cWIL7V6 "+(t.ignore?"qPDT063ZjLL1LaLsL3C3":"")},t.word))})}},{key:"render",value:function(){var e=this.props,t=e.width,r=e.height;return s.createElement(s.Fragment,null,s.createElement("video",{className:"WmiDM2H63Fe4vvp4CO_O",preload:"auto",width:t,height:r,onCanPlayThrough:this.updateIsPlaying,onEnded:this.props.onEnd,onError:this.handleError,onLoadStart:this.props.onLoad,onPlay:this.handlePlay,onTimeUpdate:this.handleTimeUpdate,ref:this.video}),null!==this.props.youtubeAlignedLyrics&&s.createElement(s.Fragment,null,s.createElement("div",{key:this.props.youtubeVideoId+"_upcomingLyricsContainer",style:{width:t,height:r},className:F},s.createElement("div",{style:{width:t},className:Y},s.createElement("div",{ref:this.upcomingLyrics,className:Q+" f9mwqUIyq8n39TfLTaxA",style:{color:this.props.upcomingLyricsColor}},this.renderLyricsLines()),s.createElement("div",{className:"uLWyZlknFLp5CBlgbOwL"},"ðŸ‘ðŸ‘ðŸ‘"))),s.createElement("div",{key:this.props.youtubeVideoId+"_playedLyricsContainer",style:{width:t,height:r},className:F},s.createElement("div",{style:{width:t},className:Y},s.createElement("div",{ref:this.playedLyrics,className:Q+" HoEkbblMfV1Sbi8OMAq1",style:{color:this.props.playedLyricsColor}},this.renderLyricsLines()))),s.createElement("div",{key:this.props.youtubeVideoId+"_progressBar",ref:this.progressBar,style:{width:t/1.5},className:"YpjBnlromUJVCloE9kpQ"},s.createElement("div",{className:"NfLuy1e_VEsD3nZaYQvU"}))))}},{key:"getFocusY",value:function(){return Math.floor(this.props.height/2.5)}},{key:"getLyricsEnd",value:function(){for(var e=null,t=this.props.youtubeAlignedLyrics.length-1;t>=0;t--)if(this.props.youtubeAlignedLyrics[t].length){e=this.props.youtubeAlignedLyrics[t];break}return null===e?this.props.youtubeVideoDuration:e[e.length-1].end}},{key:"getGapStart",value:function(e){if(e>=0&&e<this.props.youtubeAlignedLyrics.length){if(this.props.youtubeAlignedLyrics[e].length){var t=this.props.youtubeAlignedLyrics[e];return t[t.length-1].end}for(var r=e-1;r>=0;r--)if(this.props.youtubeAlignedLyrics[r].length){var i=this.props.youtubeAlignedLyrics[r];return i[i.length-1].end}return 0}return-2===e?this.getGapStart(this.props.youtubeAlignedLyrics.length-1):0}},{key:"getGapEnd",value:function(e){if(e>=-1&&e++,e>=0&&e<this.props.youtubeAlignedLyrics.length){if(this.props.youtubeAlignedLyrics[e].length)return this.props.youtubeAlignedLyrics[e][0].start;for(var t=e+1;t<this.props.youtubeAlignedLyrics.length;t++)if(this.props.youtubeAlignedLyrics[t].length)return this.props.youtubeAlignedLyrics[t][0].start}return this.props.youtubeVideoDuration}},{key:"getCurrentLineIndex",value:function(e){var t=0,r=this.props.youtubeAlignedLyrics.findIndex(function(r){return r.length>0&&(t=parseFloat(r[0].start)),e<t||(r.length>0&&(t=parseFloat(r[r.length-1].end)),!1)});return r>=0?r-1:-1===r?e<this.getLyricsEnd()?this.props.youtubeAlignedLyrics.length-1:-2:0}},{key:"updateLyricsPosition",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==this.props.youtubeAlignedLyrics&&this.video.current){var i=this.props.youtubeVideoDuration;null===r&&(r=this.video.current.currentTime+.2),r>i&&(r=i);var n=this.getCurrentLineIndex(r);if(this.previousCurrentLine!==n){this.previousCurrentLine=n,this.gapStart=this.getGapStart(n),this.gapEnd=this.getGapEnd(n),this.gapEnd-this.gapStart>=t.minGapForProgress&&-2!==n?this.gapEnd-=t.gapPadding:(this.gapStart=-1,this.gapEnd=-1),-1===n&&(n=0),-2===n?(n=this.props.youtubeAlignedLyrics.length-1,this.upcomingLyrics.current.parentElement.parentElement.style.opacity=0,this.playedLyrics.current.parentElement.parentElement.style.opacity=0):(this.upcomingLyrics.current.parentElement.parentElement.style.opacity=1,this.playedLyrics.current.parentElement.parentElement.style.opacity=1);var s=this.getFocusY(),o=this.upcomingLyrics.current.children[n].offsetTop;this.upcomingLyrics.current.parentElement.style.top=s-o+"px",this.playedLyrics.current.parentElement.style.top=s-o+"px",this.playedLyrics.current.children[n].style.visibility="visible",this.playedLyrics.current.children[n].style.opacity=1,this.upcomingLyrics.current.children[n].style.visibility="visible",this.upcomingLyrics.current.children[n].style.opacity=1;for(var u=n+1;u<this.props.youtubeAlignedLyrics.length;u++){for(var a=0;a<this.playedLyrics.current.children[u].children.length;a++)this.playedLyrics.current.children[u].children[a].firstChild.style.width="0%";this.playedLyrics.current.children[u].style.visibility="visible",this.playedLyrics.current.children[u].style.opacity=1,this.upcomingLyrics.current.children[u].style.visibility="visible",this.upcomingLyrics.current.children[u].style.opacity=1}if(n-1>=0){for(var c=0;c<this.playedLyrics.current.children[n-1].children.length;c++)this.playedLyrics.current.children[n-1].children[c].firstChild.style.width="100%";this.upcomingLyrics.current.children[n-1].style.visibility="visible",this.playedLyrics.current.children[n-1].style.visibility="visible",this.playedLyrics.current.children[n-1].style.opacity=.8,this.upcomingLyrics.current.children[n-1].style.opacity=.8}n-2>=0&&(this.upcomingLyrics.current.children[n-2].style.visibility="visible",this.playedLyrics.current.children[n-2].style.visibility="visible",this.upcomingLyrics.current.children[n-2].style.opacity=.6,this.playedLyrics.current.children[n-2].style.opacity=.6),n-3>=0&&(this.upcomingLyrics.current.children[n-2].style.visibility="visible",this.playedLyrics.current.children[n-2].style.visibility="visible",this.upcomingLyrics.current.children[n-3].style.opacity=.3,this.playedLyrics.current.children[n-3].style.opacity=.3),n-4>=0&&(this.upcomingLyrics.current.children[n-2].style.visibility="visible",this.playedLyrics.current.children[n-2].style.visibility="visible",this.upcomingLyrics.current.children[n-4].style.opacity=0,this.playedLyrics.current.children[n-4].style.opacity=0);for(var l=0;l<n-5;l++)this.upcomingLyrics.current.children[l].style.visibility="hidden",this.playedLyrics.current.children[l].style.visibility="hidden"}-1===n&&(n=0),-2===n&&(n=this.props.youtubeAlignedLyrics.length-1);var p=this.props.youtubeAlignedLyrics[n];p.length&&p.forEach(function(t,i){var s=parseFloat(t.start),o=parseFloat(t.end),u=0;if(r>=o)u=100;else if(r>=s){var a=o-s;a>0&&(u=(r-s)/a*100)}void 0!==e.playedLyrics.current.children[n]&&void 0!==e.playedLyrics.current.children[n].children[i]&&(e.playedLyrics.current.children[n].children[i].firstChild.style.width=u+"%")}),-1!==this.gapStart&&(r>=this.gapStart&&r<this.gapEnd?(this.upcomingLyrics.current.parentElement.parentElement.style.opacity=0,this.playedLyrics.current.parentElement.parentElement.style.opacity=0,this.progressBar.current.style.opacity=1,this.progressBar.current.firstChild.style.width=(r-(this.gapStart+1))/(this.gapEnd-(this.gapStart+1))*100+"%"):(this.progressBar.current.firstChild.style.width="100%",this.upcomingLyrics.current.parentElement.parentElement.style.opacity=1,this.playedLyrics.current.parentElement.parentElement.style.opacity=1,this.progressBar.current.style.opacity=0))}}},{key:"startLyricsTimer",value:function(){this.state.lyricsUpdateTimer||null===this.props.youtubeAlignedLyrics||this.setState({lyricsUpdateTimer:setInterval(this.updateLyricsPosition.bind(this),100)})}},{key:"stopLyricsTimer",value:function(){this.state.lyricsUpdateTimer&&(clearInterval(this.state.lyricsUpdateTimer),this.setState({lyricsUpdateTimer:!1}))}}])}(s.Component);(0,a.A)(W,"minGapForProgress",15),(0,a.A)(W,"gapPadding",5),(0,a.A)(W,"propTypes",{isPlaying:n().bool.isRequired,youtubeVideoId:n().string.isRequired,youtubeAlignedLyrics:n().array,youtubeVideoDuration:n().number.isRequired,width:n().number.isRequired,height:n().number.isRequired,onAudioElement:n().func.isRequired,onEnd:n().func.isRequired,onError:n().func.isRequired,onLoad:n().func.isRequired,onPlay:n().func.isRequired,onStatus:n().func.isRequired,upcomingLyricsColor:n().string,playedLyricsColor:n().string});const K=(0,o.Ng)(function(e){return{upcomingLyricsColor:e.prefs.upcomingLyricsColor,playedLyricsColor:e.prefs.playedLyricsColor}})(W);function H(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(H=function(){return!!e})()}var Z=s.lazy(function(){return Promise.all([r.e(90),r.e(950)]).then(r.bind(r,19950))}),X={CDGPlayer:j,MP4Player:V,YOUTUBEPlayer:K},$=function(e){function t(){var e,r,i,n;(0,S.A)(this,t);for(var s=arguments.length,o=new Array(s),u=0;u<s;u++)o[u]=arguments[u];return r=this,i=t,n=[].concat(o),i=(0,T.A)(i),e=(0,O.A)(r,H()?Reflect.construct(i,n||[],(0,T.A)(r).constructor):i.apply(r,n)),(0,a.A)(e,"audioCtx",new(window.AudioContext||window.webkitAudioContext)),(0,a.A)(e,"audioGainNode",e.audioCtx.createGain()),(0,a.A)(e,"audioSourceNode",null),(0,a.A)(e,"isFetching",!1),(0,a.A)(e,"state",{visualizerAudioSourceNode:e.audioCtx.createGain()}),(0,a.A)(e,"handleAudioElement",function(t){e.audioSourceNode=e.audioCtx.createMediaElementSource(t),e.audioSourceNode.connect(e.audioGainNode),e.audioGainNode.connect(e.audioCtx.destination);var r=e.audioSourceNode;e.setState({visualizerAudioSourceNode:r})}),(0,a.A)(e,"handlePlay",function(){e.isFetching=!1,e.updateVolume(),e.props.onPlay()}),(0,a.A)(e,"updateVolume",function(){var t=e.props.volume,r=e.props,i=r.isReplayGainEnabled,n=r.rgTrackGain,s=r.rgTrackPeak;if(i&&"number"==typeof n&&"number"==typeof s){var o=e.props.rgTrackGain,u=10*Math.log10(e.props.rgTrackPeak),a=o+u>=0?-.01-u:o;t*=Math.pow(10,a/10)}e.audioGainNode.gain.setValueAtTime(t,e.audioCtx.currentTime)}),e}return(0,w.A)(t,e),(0,I.A)(t,[{key:"componentDidMount",value:function(){this.updateVolume()}},{key:"componentDidUpdate",value:function(e){this.props.isPlaying&&!e.isPlaying&&this.audioCtx.resume(),this.props.mediaKey!==e.mediaKey&&(this.isFetching=!0),this.isFetching||e.volume===this.props.volume&&e.rgTrackGain===this.props.rgTrackGain&&e.rgTrackPeak===this.props.rgTrackPeak&&e.isReplayGainEnabled===this.props.isReplayGainEnabled||this.updateVolume()}},{key:"render",value:function(){if(!this.props.isVisible||"number"!=typeof this.props.mediaId&&!this.props.youtubeVideoId)return null;var e=X[this.props.mediaType.toUpperCase()+"Player"];if(void 0===e)return this.props.onError("No player for mediaType: ".concat(this.props.mediaType)),null;var t="cdg"===this.props.mediaType&&this.props.isWebGLSupported&&this.props.visualizer.isEnabled;return s.createElement(s.Fragment,null,s.createElement(e,(0,k.A)({},this.props,{onAudioElement:this.handleAudioElement,onPlay:this.handlePlay})),t&&s.createElement(Z,{audioSourceNode:this.state.visualizerAudioSourceNode,isPlaying:this.props.isPlaying,onError:this.props.onError,presetKey:this.props.visualizer.presetKey,sensitivity:this.props.visualizer.sensitivity,width:this.props.width,height:this.props.height}))}}])}(s.Component);(0,a.A)($,"propTypes",{cdgAlpha:n().number.isRequired,cdgSize:n().number.isRequired,isPlaying:n().bool.isRequired,isVisible:n().bool.isRequired,isReplayGainEnabled:n().bool.isRequired,isWebGLSupported:n().bool.isRequired,mediaId:n().number,mediaKey:n().number,mediaType:n().string,youtubeVideoId:n().string,youtubeAlignedLyrics:n().array,youtubeVideoDuration:n().number,mp4Alpha:n().number.isRequired,rgTrackGain:n().number,rgTrackPeak:n().number,visualizer:n().object.isRequired,volume:n().number.isRequired,width:n().number.isRequired,height:n().number.isRequired,onEnd:n().func.isRequired,onError:n().func.isRequired,onLoad:n().func.isRequired,onPlay:n().func.isRequired,onStatus:n().func.isRequired});const ee=$;var te=r(19997),re=r(94689),ie=r(6868);function ne(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ne=function(){return!!e})()}var se=function(e){function t(){var e,r,i,n;(0,S.A)(this,t);for(var s=arguments.length,o=new Array(s),u=0;u<s;u++)o[u]=arguments[u];return r=this,i=t,n=[].concat(o),i=(0,T.A)(i),e=(0,O.A)(r,ne()?Reflect.construct(i,n||[],(0,T.A)(r).constructor):i.apply(r,n)),(0,a.A)(e,"timeoutID",null),(0,a.A)(e,"state",{show:!1}),e}return(0,w.A)(t,e),(0,I.A)(t,[{key:"componentDidMount",value:function(){this.animate()}},{key:"componentDidUpdate",value:function(e,t){this.props.queueItem.queueId!==e.queueItem.queueId&&this.animate()}},{key:"animate",value:function(){var e=this;clearTimeout(this.timeoutID),this.setState({show:!0}),this.timeoutID=setTimeout(function(){e.setState({show:!1})},5e3)}},{key:"render",value:function(){return s.createElement("div",{className:"ztWniIznPl6ywm0j65nW"},s.createElement(re.A,{unmountOnExit:!0,in:this.state.show,timeout:1e3,classNames:{appear:"",appearActive:"",enter:"Mla6c4A_J_vWspbQ9XoH",enterActive:"ZyHrK1r1SkGrJKse1viz Mla6c4A_J_vWspbQ9XoH",exit:"uzOmlt8RuyphXNFJM_uI",exitActive:"RJM4inFydeiDag3Nre2U uzOmlt8RuyphXNFJM_uI"}},s.createElement("div",{className:"UBaElfqrBTgaF4jIGH_w"},s.createElement(ie.A,{userId:this.props.queueItem.userId,dateUpdated:this.props.queueItem.dateUpdated,className:"Q2KBXSyDS_61hMQff6Zp"}),s.createElement("div",{className:"N_kMqAEJY9q1nZBGsVUL"},this.props.queueItem.userDisplayName))))}}])}(s.Component);(0,a.A)(se,"propTypes",{queueItem:n().object.isRequired});const oe=se,ue="FQpKtHbs3r0MzUvNPO_A";function ae(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ae=function(){return!!e})()}var ce=function(e){function t(){return(0,S.A)(this,t),e=this,r=t,i=arguments,r=(0,T.A)(r),(0,O.A)(e,ae()?Reflect.construct(r,i||[],(0,T.A)(e).constructor):r.apply(e,i));var e,r,i}return(0,w.A)(t,e),(0,I.A)(t,[{key:"render",value:function(){var e,t=this.props,r=t.queueItem,i=t.width,n=t.height;if(this.props.isQueueEmpty||this.props.isAtQueueEnd)e=s.createElement(te.A,{text:"CAN HAZ MOAR SONGZ?",className:ue});else if(r)if(this.props.isErrored){var o=-300*Math.random();e=s.createElement(s.Fragment,null,s.createElement(te.A,{text:"OOPS...",offset:o,className:ue}),s.createElement(te.A,{text:"SEE QUEUE FOR DETAILS",offset:o,className:ue}))}else e=s.createElement(oe,{queueItem:r});else e=s.createElement(te.A,{text:"PRESS PLAY TO BEGIN",className:ue});return s.createElement("div",{style:{width:i,height:n},className:"KR1xPhhGxBDKGqbw_jFu"},e)}}])}(s.Component);(0,a.A)(ce,"propTypes",{queueItem:n().object,isAtQueueEnd:n().bool.isRequired,isQueueEmpty:n().bool.isRequired,isErrored:n().bool.isRequired,width:n().number.isRequired,height:n().number.isRequired});const le=ce;function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach(function(t){(0,a.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ye(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ye=function(){return!!e})()}var he=function(e){function t(){var e,r,i,n;(0,S.A)(this,t);for(var s=arguments.length,o=new Array(s),u=0;u<s;u++)o[u]=arguments[u];return r=this,i=t,n=[].concat(o),i=(0,T.A)(i),e=(0,O.A)(r,ye()?Reflect.construct(i,n||[],(0,T.A)(r).constructor):i.apply(r,n)),(0,a.A)(e,"state",{queueItem:null}),(0,a.A)(e,"handleError",function(t){e.props.playerError(t),e.handleStatus()}),(0,a.A)(e,"handleLoadNext",function(){var t=e.props.queue.result.indexOf(e.props.queueId);if(t!==e.props.queue.result.length-1){var r=JSON.parse(e.props.historyJSON);-1!==e.props.queueId&&r.push(e.props.queueId),e.handleStatus({historyJSON:JSON.stringify(r),isAtQueueEnd:!1,isPlaying:!0,isPlayingNext:!1,position:0,queueId:e.props.queue.result[t+1]})}else e.handleStatus({isAtQueueEnd:!0,isPlayingNext:!1})}),(0,a.A)(e,"handleStatus",function(t){return e.props.playerStatus(de(de({},t),{},{mediaType:e.state.queueItem?e.state.queueItem.mediaType:null}))}),e}return(0,w.A)(t,e),(0,I.A)(t,[{key:"componentDidMount",value:function(){this.handleStatus(),this.setState({queueItem:this.props.queue.entities[this.props.queueId]})}},{key:"componentWillUnmount",value:function(){this.props.playerLeave()}},{key:"componentDidUpdate",value:function(e){var t=this.props;t.queueId!==e.queueId&&this.setState({queueItem:t.queue.entities[t.queueId]}),t.isPlaying&&-1===t.queueId||t.isPlayingNext||t.isAtQueueEnd&&e.queue.result!==t.queue.result?this.handleLoadNext():t.isErrored&&t.isPlaying&&!e.isPlaying?this.handleStatus({isErrored:!1}):this.handleStatus()}},{key:"render",value:function(){var e=this.props,t=this.state;return s.createElement(s.Fragment,null,s.createElement(ee,{cdgAlpha:e.cdgAlpha,cdgSize:e.cdgSize,isPlaying:e.isPlaying,isVisible:!!t.queueItem&&!e.isErrored&&!e.isAtQueueEnd,isReplayGainEnabled:e.isReplayGainEnabled,isWebGLSupported:e.isWebGLSupported,mediaId:t.queueItem?t.queueItem.mediaId:null,mediaKey:t.queueItem?t.queueItem.queueId:null,mediaType:t.queueItem?t.queueItem.mediaType:null,youtubeVideoId:t.queueItem?t.queueItem.youtubeVideoId:null,youtubeAlignedLyrics:t.queueItem?t.queueItem.youtubeAlignedLyrics:null,youtubeVideoDuration:t.queueItem?t.queueItem.youtubeVideoDuration:null,mp4Alpha:e.mp4Alpha,onEnd:this.handleLoadNext,onError:this.handleError,onLoad:e.playerLoad,onPlay:e.playerPlay,onStatus:this.handleStatus,rgTrackGain:t.queueItem?t.queueItem.rgTrackGain:null,rgTrackPeak:t.queueItem?t.queueItem.rgTrackPeak:null,visualizer:e.visualizer,volume:e.volume,width:e.width,height:e.height}),s.createElement(le,{queueItem:t.queueItem,isAtQueueEnd:e.isAtQueueEnd,isQueueEmpty:e.isQueueEmpty,isErrored:e.isErrored,width:e.width,height:e.height}))}}])}(s.Component);(0,a.A)(he,"propTypes",{cdgAlpha:n().number.isRequired,cdgSize:n().number.isRequired,historyJSON:n().string.isRequired,isAtQueueEnd:n().bool.isRequired,isErrored:n().bool.isRequired,isPlaying:n().bool.isRequired,isPlayingNext:n().bool.isRequired,isQueueEmpty:n().bool.isRequired,isReplayGainEnabled:n().bool.isRequired,isWebGLSupported:n().bool.isRequired,mp4Alpha:n().number.isRequired,queue:n().object.isRequired,queueId:n().number.isRequired,rgTrackGain:n().number,rgTrackPeak:n().number,visualizer:n().object.isRequired,volume:n().number.isRequired,width:n().number.isRequired,height:n().number.isRequired,playerLeave:n().func.isRequired,playerError:n().func.isRequired,playerLoad:n().func.isRequired,playerPlay:n().func.isRequired,playerStatus:n().func.isRequired});const me=he;var ge=r(9934),fe=r(1081),ve=function(e){return(0,ge.wd)(e.queue).result},Ae=function(e){return(0,ge.wd)(e.queue).entities},be=(0,fe.Mz)([ve,function(e){return e.status.historyJSON},function(e){return e.status.queueId}],function(e,t,r){var i=JSON.parse(t);return-1!==r&&i.push(r),i.filter(function(t){return e.includes(t)})}),Ee=(0,fe.Mz)([ve,Ae,be],function(e,t,r){var i=[],n=r.map(function(e){return t[e].userId});for(e=e.filter(function(e){return!(r.includes(e)||t[e].youtubeVideoId&&"ready"!==t[e].youtubeVideoStatus||(i.push(t[e].userId),0))});e.length;){var s=Le(i,n),o=i.indexOf(s),u=e.splice(o,1)[0];i.splice(o,1),r.push(u),n.push(s)}return r});function Le(e,t){var r=Array.from(new Set(e)),i=[];return r.forEach(function(e){var r=t.lastIndexOf(e);i.push(-1===r?1/0:t.length-r)}),r[i.indexOf(Math.max.apply(Math,i))]}const Re=(0,fe.Mz)([Ee,Ae],function(e,t){return{result:e,entities:t}});var Pe={playerLeave:function(){return function(e,t){e({type:c.bO,payload:{type:l.PLAYER_EMIT_STATUS}}),e({type:l.PLAYER_EMIT_LEAVE})}},playerError:function(e){return{type:l.PLAYER_ERROR,payload:{message:e}}},playerLoad:function(){return{type:l.PLAYER_LOAD}},playerPlay:function(){return{type:l.PLAYER_PLAY}},playerStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(r,i){r({type:l.PLAYER_UPDATE,payload:e});var n=i(),s=n.player,o=n.playerVisualizer;r({type:l.PLAYER_EMIT_STATUS,payload:{cdgAlpha:s.cdgAlpha,cdgSize:s.cdgSize,errorMessage:s.errorMessage,historyJSON:s.historyJSON,isAtQueueEnd:s.isAtQueueEnd,isErrored:s.isErrored,isPlaying:s.isPlaying,isWebGLSupported:s.isWebGLSupported,mediaType:s.mediaType,mp4Alpha:s.mp4Alpha,position:s.position,queueId:s.queueId,volume:s.volume,visualizer:o},meta:{throttle:{wait:1e3,leading:!t}}})}},playerVisualizerError:function(e){return{type:l.PLAYER_VISUALIZER_ERROR,payload:{message:e.message}}}};const qe=(0,o.Ng)(function(e){var t=e.player,r=e.playerVisualizer,i=e.prefs,n=(0,ge.wd)(e.queue);return{cdgAlpha:t.cdgAlpha,cdgSize:t.cdgSize,historyJSON:t.historyJSON,isAtQueueEnd:t.isAtQueueEnd,isErrored:t.isErrored,isPlaying:t.isPlaying,isPlayingNext:t.isPlayingNext,isQueueEmpty:0===n.result.length,isReplayGainEnabled:i.isReplayGainEnabled,isWebGLSupported:t.isWebGLSupported,mp4Alpha:t.mp4Alpha,queue:Re(e),queueId:t.queueId,volume:t.volume,visualizer:r}},Pe)(me),Se=qe;var Ie=r(51916),Oe=r.n(Ie);var Te=function(e){var t=(0,o.d4)(function(e){return e.ui}),r=t.innerWidth,i=t.innerHeight,n=t.headerHeight,a=i-n-t.footerHeight;s.useLayoutEffect(function(){return e.setHeader(null)});var c=(0,o.Pj)();return(0,o.d4)(function(e){return e.player})||((0,u.Mh)(c,{key:"player",reducer:m}),(0,u.Mh)(c,{key:"playerVisualizer",reducer:R})),s.createElement("div",{style:{overflow:"hidden"}},s.createElement("div",{id:"player-fs-container",className:"gdWFZNJZjyDozcxHMCpw",style:{top:Oe().isFullscreen?0:n,width:r,height:Oe().isFullscreen?i:a}},s.createElement(Se,{width:r,height:Oe().isFullscreen?i:a})))};Te.propTypes={setHeader:n().func.isRequired};const we=Te}}]);